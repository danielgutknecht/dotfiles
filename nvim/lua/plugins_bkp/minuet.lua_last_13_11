-- ~/.config/nvim/lua/plugins/minuet.lua
-- lazyvim: https://www.lazyvim.org, https://github.com/LazyVim/LazyVim
return {
  -- Minuet AI
  {
    "milanglacier/minuet-ai.nvim",
    dependencies = {
      "saghen/blink.cmp",
      "nvim-lua/plenary.nvim",
      "nvim-mini/mini.snippets", -- nome atualizado
    },
    event = "InsertEnter",
    opts = function()
      return {
        provider = "codestral", -- ou "claude", "gemini", "codestral"
        -- openai = {
        --   api_key = vim.env.OPENAI_API_KEY or "sk-...",
        --   model = "gpt-4o-mini",
        -- },
        virtualtext = {
          auto_trigger_ft = {
            "lua",
            "python",
            "javascript",
            "typescript",
            "javascriptreact",
            "typescriptreact",
            "rust",
            "go",
            "html",
            "css",
            "json",
            "yaml",
            "yml",
            "toml",
            "markdown",
          },
          min_prefix_length = 2,
          debounce_ms = 300,
          max_tokens = 512,
          keymap = {
            accept = "<A-L>",
            accept_line = "<A-l>",
            prev = "<A-[>",
            next = "<A-]>",
            dismiss = "<A-h>",
          },
        },
        notify = "warn",
        request_timeout = 20,
      }
    end,
    config = function(_, opts)
      require("minuet").setup(opts)
    end,
  },

  -- Blink.cmp
  {
    "saghen/blink.cmp",
    version = "*",
    event = "InsertEnter",
    opts = {
      keymap = {
        preset = "default",
        -- Controles principais
        ["<C-Space>"] = { "show", "show_documentation", "hide_documentation" },
        ["<C-e>"] = { "hide" },
        ["<CR>"] = { "accept", "fallback" },
        -- Navegação com Tab e Shift+Tab
        ["<Tab>"] = { "select_next", "fallback" },
        ["<S-Tab>"] = { "select_prev", "fallback" },
        -- Navegação com Ctrl+j/k (Vim-style)
        ["<C-k>"] = { "select_prev", "fallback" },
        ["<C-j>"] = { "select_next", "fallback" },
        -- Navegação com setas (fallback)
        ["<Up>"] = { "select_prev", "fallback" },
        ["<Down>"] = { "select_next", "fallback" },
        -- Scroll de documentação
        ["<C-b>"] = { "scroll_documentation_up", "fallback" },
        ["<C-f>"] = { "scroll_documentation_down", "fallback" },
      },

      appearance = {
        use_nvim_cmp_as_default = true,
        nerd_font_variant = "mono",
      },

      completion = {
        accept = {
          auto_brackets = { enabled = true },
        },
        menu = {
          draw = {
            columns = {
              { "kind_icon" },
              { "label", "label_description", gap = 1 },
              { "kind" },
            },
          },
        },
        documentation = {
          auto_show = true,
          auto_show_delay_ms = 400,
        },
      },

      -- Fontes de completação
      sources = {
        default = { "lsp", "path", "snippets", "buffer", "minuet" },
        providers = {
          minuet = {
            name = "minuet",
            module = "minuet.blink",
            score_offset = 80, -- Prioridade alta
          },
        },
      },
    },
  },
}
